<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Batching · Hot Chocolate</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="_Hot Chocolate_ supports operation batching and request batching. But before we get into the details lets reflect on what batching is and what you can do with it."/><meta name="docsearch:version" content="10.1.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Batching · Hot Chocolate"/><meta property="og:type" content="website"/><meta property="og:url" content="https://hotchocolate.io/"/><meta property="og:description" content="_Hot Chocolate_ supports operation batching and request batching. But before we get into the details lets reflect on what batching is and what you can do with it."/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://hotchocolate.io/img/cupcake.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-72800164-3', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster:700,400"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/signet.svg" alt="Hot Chocolate"/><h2 class="headerTitleWithLogo">Hot Chocolate</h2></a><a href="/versions"><h3>10.1.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/10.1.0/introduction" target="_self">Docs</a></li><li class=""><a href="/docs/10.1.0/example-star-wars-code-first" target="_self">Examples</a></li><li class=""><a href="https://chillicream.com/blog" target="_blank">Blog</a></li><li class=""><a href="https://shop.chillicream.com" target="_blank">Shop</a></li><li class=""><a href="https://github.com/ChilliCream/hotchocolate" target="_blank">GitHub</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>API Reference</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/10.1.0/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/code-first">Code-first</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-first">Schema-first</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Schema Definition</h4><ul><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema">Schema</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-object-type">Object Type</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-interface-type">Interface Type</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-union-type">Union Type</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-input-object-type">Input Object Type</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-enum-type">Enum Type</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/schema-descriptions">Schema Descriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/custom-scalar-types">Scalar Type Support</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/resolvers">Resolvers</a></li></ul></div><li class="navListItem"><a class="navItem" href="/docs/10.1.0/dataloaders">Data Loaders</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/pagination">Pagination</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/filters">Filter and Sorting Support</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/dependency-injection">Dependency Injection</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/authorization">Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/middleware">Middleware</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/custom-context">Custom Context Data</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/code-first-subscription">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/options">Options</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/type-conversion">Type Conversion</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/aspnet">ASP.NET</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/parser">Parser</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/errors">Error Filter</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/security">Security</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/validation-rule">Validation Rules</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/stitching">Schema Stitching</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/instrumentation">Instrumentation</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/apollo-tracing">Apollo Tracing</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/conventions">Conventions</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/extending-types">Extending Types</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/relay">Relay</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/10.1.0/batching">Batching</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/persisted-queries">Persisted Queries</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/10.1.0/migration">Migrating from 0.6.x</a></li><li class="navListItem"><a class="navItem" href="/docs/10.1.0/dotnet-cli">.NET CLI</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/ChilliCream/hotchocolate-docs/edit/master/docs/batching.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Batching</h1></header><article><div><span><p><em>Hot Chocolate</em> supports operation batching and request batching. But before we get into the details lets reflect on what batching is and what you can do with it.</p>
<p><a href="https://youtu.be/ViXL0YQnioU?t=626"><img src="../../../../img/batching.png" height="400" width="600"></a></p>
<h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>With batching we have added the capability run a sequence of operations. The batch is executed in order and the results of each request is yielded to the user once it has been computed. This means that we do not have to wait for the complete batch to be completed and can use the results as they are written to the response stream.</p>
<p>This means that with batching we are able to delay expensive queries. Essentially, we can do something that we also can do with <code>@defer</code>.</p>
<p>Let's say we had a news site and wanted to fetch the stories and for each story the first two comments.</p>
<p>We could do that with a single query like the following:</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> NewsFeed <span class="token punctuation">{</span>
  stories <span class="token punctuation">{</span>
    id <span class="token directive function">@export</span><span class="token punctuation">(</span><span class="token attr-name">as</span><span class="token punctuation">:</span> <span class="token string">"ids"</span><span class="token punctuation">)</span>
    actor
    message
    comments<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      actor
      message
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>But in our case, we want the story content to be available really, really quickly and we do not mind if the comments appear a little later. So, what we could do here is to break this query into two and send them in as batch.</p>
<p><code>POST /graphql?batchOperations=[NewsFeed, StoryComments]</code></p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> NewsFeed <span class="token punctuation">{</span>
  stories <span class="token punctuation">{</span>
    id <span class="token directive function">@export</span><span class="token punctuation">(</span><span class="token attr-name">as</span><span class="token punctuation">:</span> <span class="token string">"ids"</span><span class="token punctuation">)</span>
    actor
    message
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> StoryComments <span class="token punctuation">{</span>
  stories<span class="token punctuation">(</span><span class="token attr-name">ids</span><span class="token punctuation">:</span> <span class="token variable">$ids</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    comments<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      actor
      message
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The key to do this is our <code>@export</code> directive which is able to export results as variables for the next queries in the batch. Each query can add to the variables collection.</p>
<p>Batching combined with <code>@export</code> becomes really interesting if you think about mutations. With this you can create a sequence of mutations that should run on your server and each result of a mutation can become a input for the next mutation in the chain. This allows you to efficiently write flows that run asynchronously on the server.</p>
<h2><a class="anchor" aria-hidden="true" id="operation-batching"></a><a href="#operation-batching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Operation Batching</h2>
<p>With operation batching you basically send in the same request as before. You can either opt to send plain GraphQL or send in the GraphQL-JSON-request.</p>
<blockquote>
<p>More about the request structure can be read <a href="/docs/10.1.0/aspnet">here</a>.</p>
</blockquote>
<p>Since we are sending in multiple operations, we specify the sequence with as a query parameter:</p>
<p><code>POST /graphql?batchOperations=[Operation1, Operation2, Operation3, Operation4]</code></p>
<p>Currently we write the result as JSON-array into the HTTP-response-stream. Each result is written to the response stream as it appears so you could grab each element as it appears. If you want to change the serialization format you can implement <code>IResponseStreamSerializer</code> and register you custom serializer with the dependency injection.</p>
<pre><code class="hljs css language-csharp">services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddResponseStreamSerializer</span><span class="token punctuation">&lt;</span><span class="token class-name">CustomResponseStreamSerializer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="request-batching"></a><a href="#request-batching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request Batching</h2>
<p>Request batching is essentially a way to send in multiple GraphQL-JSON-requests. These requests are basically wrapped into a JSON-array and send in the same way as the standard GraphQL-JSON-request.</p>
<pre><code class="hljs css language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        # The query document.
        <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"query getHero { hero { name } }"</span><span class="token punctuation">,</span>

        # The name of the operation that shall be executed.
        <span class="token property">"operationName"</span><span class="token operator">:</span> <span class="token string">"getHero"</span><span class="token punctuation">,</span>

        # A key under which a query document was safed on the server.
        <span class="token property">"namedQuery"</span><span class="token operator">:</span> <span class="token string">"W5vrrAIypCbniaIYeroNnw=="</span><span class="token punctuation">,</span>

        # The variable values for this request.
        <span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"a"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"abc"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        # Custom properties that can be passed to the execution engine context data.
        <span class="token property">"extensions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"a"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"abc"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        # The query document.
        <span class="token property">"query"</span><span class="token operator">:</span> <span class="token string">"query getHero { hero { name } }"</span><span class="token punctuation">,</span>

        # The name of the operation that shall be executed.
        <span class="token property">"operationName"</span><span class="token operator">:</span> <span class="token string">"getHero"</span><span class="token punctuation">,</span>

        # A key under which a query document was safed on the server.
        <span class="token property">"namedQuery"</span><span class="token operator">:</span> <span class="token string">"W5vrrAIypCbniaIYeroNnw=="</span><span class="token punctuation">,</span>

        # The variable values for this request.
        <span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"a"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"abc"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>

        # Custom properties that can be passed to the execution engine context data.
        <span class="token property">"extensions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"a"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"b"</span><span class="token operator">:</span> <span class="token string">"abc"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="export-directive"></a><a href="#export-directive" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Export Directive</h2>
<p>The export directive allows to export the results of a query into a global variable pool from which each query in the sequence can pull data in.</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> NewsFeed <span class="token punctuation">{</span>
  stories <span class="token punctuation">{</span>
    id <span class="token directive function">@export</span><span class="token punctuation">(</span><span class="token attr-name">as</span><span class="token punctuation">:</span> <span class="token string">"ids"</span><span class="token punctuation">)</span>
    actor
    message
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> StoryComments <span class="token punctuation">{</span>
  stories<span class="token punctuation">(</span><span class="token attr-name">ids</span><span class="token punctuation">:</span> <span class="token variable">$ids</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    comments<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      actor
      message
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the above example we are exporting the <code>id</code> field result into a variable <code>ids</code>. Since we are exporting multiple ids the variable is essentially becoming a list. In our example we will get a list of <code>System.String</code>. As we collect the variables, we will hold them as the native .NET type and only coerce them once we have to create the variable inputs for the next operation.</p>
<p>As can be seen in the above example we have not declared any variable for the next operation and are just using <code>$ids</code>. While we still could declare the variable explicitly, we can infer the variable declaration. The query engine will essentially rewrite the query.</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> StoryComments<span class="token punctuation">(</span><span class="token variable">$ids</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ID<span class="token operator">!</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stories<span class="token punctuation">(</span><span class="token attr-name">ids</span><span class="token punctuation">:</span> <span class="token variable">$ids</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    comments<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      actor
      message
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can also export objects, so you are not limited to scalars.</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> NewsFeed <span class="token punctuation">{</span>
  stories <span class="token directive function">@export</span> <span class="token punctuation">{</span>
    id
    actor
    message
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In the above example we would export a list of story objects that would be coerced and converted to fit into an input object.</p>
<h2><a class="anchor" aria-hidden="true" id="ibatchqueryexecutor"></a><a href="#ibatchqueryexecutor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>IBatchQueryExecutor</code></h2>
<p>If you want to write tests or implement your own batching middleware, then you just have to inject <code>IBatchQueryExecutor</code>. The batch executor will return a <code>IBatchQueryExecutionResult</code> which is essentially a <code>IResponseStream</code>.</p>
<p>The response stream allows to read the results from the stream as they become available.</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>responseStream<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">IReadOnlyQueryResult</span> queryResult <span class="token operator">=</span> <span class="token keyword">await</span> responseStream<span class="token punctuation">.</span><span class="token function">ReadAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">ToJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-9-17 by Michael Staib</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/10.1.0/relay"><span class="arrow-prev">← </span><span>Relay</span></a><a class="docs-next button" href="/docs/10.1.0/persisted-queries"><span>Persisted Queries</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#operation-batching">Operation Batching</a></li><li><a href="#request-batching">Request Batching</a></li><li><a href="#export-directive">Export Directive</a></li><li><a href="#ibatchqueryexecutor"><code>IBatchQueryExecutor</code></a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/signet.svg" alt="Hot Chocolate" width="64" height="64"/></a><div><h5>Docs</h5><a href="/docs/introduction.html">Quickstart</a><a href="/docs/code-first.html">Code-First</a><a href="/docs/options.html">General</a></div><div><h5>Examples</h5><a href="/docs/example-star-wars-code-first.html">Star Wars</a></div><div><h5>Community</h5><a href="https://join.slack.com/t/hotchocolategraphql/shared_invite/enQtNTA4NjA0ODYwOTQ0LTViMzA2MTM4OWYwYjIxYzViYmM0YmZhYjdiNzBjOTg2ZmU1YmMwNDZiYjUyZWZlMzNiMTk1OWUxNWZhMzQwY2Q" target="_blank" rel="noreferrer noopener">Join us on Slack</a><a href="https://twitter.com/Chilli_Cream" target="_blank" rel="noreferrer noopener">Follow us on Twitter</a><a href="http://stackoverflow.com/questions/tagged/hotchocolate" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://chillicream.com/blog" target="_blank">Blog</a><a href="https://shop.chillicream.com" target="_blank">Shop</a><a href="https://github.com/ChilliCream/hotchocolate" target="_blank">GitHub</a><a href="https://github.com/ChilliCream/hotchocolate/issues" target="_blank">Issues</a><a class="github-button" href="https://github.com/ChilliCream/hotchocolate" data-icon="octicon-star" data-count-href="/chillicream/hotchocolate/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 <a href="https://chillicream.com" target="_blank">ChilliCream</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '47d61652587888cd5144dcdd6fb9117b',
                indexName: 'hotchocolate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:en","version:10.1.0"]}
              });
            </script></body></html>