<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>DataLoaders · Hot Chocolate</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;data-loaders&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#data-loaders&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Data Loaders&lt;/h2&gt;
"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="DataLoaders · Hot Chocolate"/><meta property="og:type" content="website"/><meta property="og:url" content="https://hotchocolate.io/index.html"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;data-loaders&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#data-loaders&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Data Loaders&lt;/h2&gt;
"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://hotchocolate.io/img/cupcake.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atelier-dune-light.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-72800164-3', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster:700,400"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/signet.svg" alt="Hot Chocolate"/><h2 class="headerTitleWithLogo">Hot Chocolate</h2></a><a href="/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/next/introduction" target="_self">Docs</a></li><li class=""><a href="/docs/next/example-star-wars-code-first" target="_self">Examples</a></li><li class=""><a href="https://chillicream.com/blog" target="_blank">Blog</a></li><li class=""><a href="https://github.com/ChilliCream/hotchocolate" target="_blank">GitHub</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>API Reference</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/next/code-first">Code-first</a></li><li class="navListItem"><a class="navItem" href="/docs/next/schema-first">Schema-first</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/custom-scalar-types">Scalar Type Support</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/next/dataloaders">DataLoaders</a></li><li class="navListItem"><a class="navItem" href="/docs/next/pagination">Pagination</a></li><li class="navListItem"><a class="navItem" href="/docs/next/dependency-injection">Dependency Injection</a></li><li class="navListItem"><a class="navItem" href="/docs/next/authorization">Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/next/middleware">Middleware</a></li><li class="navListItem"><a class="navItem" href="/docs/next/custom-context">Custom Context Data</a></li><li class="navListItem"><a class="navItem" href="/docs/next/options">Options</a></li><li class="navListItem"><a class="navItem" href="/docs/next/aspnet">ASP.net</a></li><li class="navListItem"><a class="navItem" href="/docs/next/parser">Parser</a></li><li class="navListItem"><a class="navItem" href="/docs/next/errors">Error Filter</a></li><li class="navListItem"><a class="navItem" href="/docs/next/security">Security</a></li><li class="navListItem"><a class="navItem" href="/docs/next/validation-rule">Validation Rules</a></li><li class="navListItem"><a class="navItem" href="/docs/next/stitching">Schema Stitching</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next/migration">Migrating from 0.6.x</a></li><li class="navListItem"><a class="navItem" href="/docs/next/dotnet-cli">.NET CLI</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/ChilliCream/hotchocolate-docs/edit/master/docs/dataloaders.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">DataLoaders</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="data-loaders"></a><a href="#data-loaders" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data Loaders</h2>
<p>If you want to read more about <em>DataLoader</em> in general, you can head over to Facebook's <a href="https://github.com/facebook/dataloader">GitHub repository</a>.</p>
<p>GraphQL is very flexible in the way you can request data. This flexibility also introduces new classes of problems called <em>n+1</em> issues for the GraphQL server developer.</p>
<p>In order to depict the issue that DataLoaders solve in this context, let me introduce a little GraphQL schema:</p>
<pre><code class="hljs css language-graphql"><span class="hljs-keyword">type</span> <span class="hljs-type">Query</span> {
  person(id: <span class="hljs-type">ID</span>): <span class="hljs-type">Person</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-type">Person</span> {
  id: <span class="hljs-type">ID</span>
  name: <span class="hljs-type">String</span>
  friends: [<span class="hljs-type">Person</span>]
}
</code></pre>
<p>The above schema allows to fetch a person by its internal identifier and each person has a list of friends that is represented by a list of persons.</p>
<p>Since GraphQL requests are not fixed requests like REST requests, the developer really defines what data he/she wants. This avoids overfetching data that you do not need and also saves you unecessary roundtrips to the GraphQL backend.</p>
<p>So, a query against the above schema could look like the following:</p>
<pre><code class="hljs css language-graphql">{
  a: person(<span class="hljs-name">id:</span> <span class="hljs-string">"a"</span>) {
    name
  }

  b: person(<span class="hljs-name">id:</span> <span class="hljs-string">"b"</span>) {
    name
  }
}
</code></pre>
<p>The above request fetches two persons in one go without the need to call the backend twice. The problem for the GraphQL backend is that field resolvers are atomic and do not have any knoledge about the query as a whole. So, a field resolver does not know that it will be called multiple times in parallel to fetch similar or equal data from the same data source.</p>
<p>This basically represents the first case where <em>DataLoader</em> help us by batching requests against our database or backend service. Currently, we allow <em>DataLoader</em> per request and globally.</p>
<p>So, let's look at some code in order to understand what they are doing. First, let's have a look at how we would write our field resolver without <em>DataLoader</em>:</p>
<pre><code class="hljs css language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;Person&gt; <span class="hljs-title">GetPerson</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> id, [Service]IPersonRepository repository</span>)</span>
{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> repository.GetPersonById(id);
}
</code></pre>
<p>The above example would result in two calls to the person repository that would than fetch the persons one by one from our data source.</p>
<p>If you think that through you can see that each GraphQL request would cause multiple requests to our data source resulting in slugish performance and uneccessary roundtrips to our data source.</p>
<p>This, means that we reduced the roundtrips from our client to our server with GraphQL but multiplied the roundtrips between the data sources and the service layer.</p>
<p>With <em>DataLoader</em> we can now centralise our person fetching and reduce the number of round trips to our data source.</p>
<p>In order to use <em>DataLoader</em> with <em>HotChocolate</em> we have to add the <em>DataLoader</em> registry. The <em>DataLoader</em> registry basically manages the data loader instances and interacts with the execution engine.</p>
<pre><code class="hljs css language-csharp">services.AddDataLoaderRegistry();
</code></pre>
<p>Next, we have to create a <em>DataLoader</em> that now acts as intermediary between a field resolver and the data source.</p>
<p>You can either implement a <em>DataLoader</em> as class or just provide us with a delegate that represents the fetch logic.</p>
<h2><a class="anchor" aria-hidden="true" id="class-dataloader"></a><a href="#class-dataloader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Class DataLoader</h2>
<p>Let us first look at the class <em>DataLoader</em>:</p>
<pre><code class="hljs css language-csharp">public class PersonDataLoader : DataLoaderBase&lt;string, Person&gt;
{
    private readonly IPersonRepository _repository;

    public PersonDataLoader(IPersonRepository repository)
      : base(new DataLoaderOptions&lt;string&gt;())
    {
        _repository = repository;
    }

    protected override async Task&lt;IReadOnlyList&lt;Result&lt;Person&gt;&gt;&gt; FetchAsync(
        IReadOnlyList&lt;string&gt; keys,
        CancellationToken cancellationToken)
    {
        return _repository.GetPersonBatch(keys);
    }
}
</code></pre>
<p>The <em>DataLoader</em> is now injected by the execution engine as a field resolver argument.</p>
<p><em>DataLoader</em> have to be injected at field resolver argument level and <strong>NOT</strong> as constructor arguments since the lifetime of a <em>DataLoader</em> is in many cases shorter than the class containing the field resolvers.</p>
<pre><code class="hljs css language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;Person&gt; <span class="hljs-title">GetPerson</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> id, [DataLoader]PersonDataLoader personLoader</span>)</span>
{
    <span class="hljs-keyword">return</span> personLoader.LoadAsync(id);
}
</code></pre>
<p>It is important that you do not have to register a <em>DataLoader</em> with your dependency injection provider. <em>HotChocolate</em> will handle the instance management and register all <em>DataLoader</em> automatically with the <em>DataLoader</em> registry that we have added earlier.</p>
<p>Now, person requests in a single execution batch will be batched to the data source.</p>
<p>But there are still some more issues ahead that <em>DataLoader</em> will help us with. For that we should amend our query a little bit.</p>
<pre><code class="hljs css language-graphql">{
  a: person(<span class="hljs-name">id:</span> <span class="hljs-string">"a"</span>) {
    name
    friends {
      name
    }
  }

  b: person(<span class="hljs-name">id:</span> <span class="hljs-string">"b"</span>) {
    name
    friends {
      name
    }
  }
}
</code></pre>
<p>The above query now drills down into the friends property, which again yields persons.</p>
<p>Let's, say our person object is located in a mongo database and the document would look something like the following:</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>:<span class="hljs-string">"a"</span>
  <span class="hljs-string">"name"</span>:<span class="hljs-string">"Foo"</span>
  <span class="hljs-string">"friends"</span>: [
    <span class="hljs-string">"b"</span>,
    <span class="hljs-string">"c"</span>,
    <span class="hljs-string">"d"</span>
  ]
}

{
  <span class="hljs-attr">"id"</span>:<span class="hljs-string">"b"</span>
  <span class="hljs-string">"name"</span>:<span class="hljs-string">"Bar"</span>
  <span class="hljs-string">"friends"</span>: [
    <span class="hljs-string">"a"</span>,
    <span class="hljs-string">"c"</span>,
    <span class="hljs-string">"e"</span>
  ]
}
</code></pre>
<p>The person with ID <code>a</code> is also friends with person <code>b</code>. Moreover, <code>a</code> is also friends with <code>c</code> and <code>d</code>. Furthermore, <code>b</code> is friends with <code>a</code> and also friends with <code>c</code> and <code>e</code>.
The best case now would be that we only fetch <code>c</code>, <code>d</code> and <code>e</code> since we have already fetched <code>a</code> and <code>b</code>.</p>
<p>This is the second problem class the <em>DataLoader</em> utility helps us with since the <em>DataLoader</em> contains a cache and holds the resolved instances by default for the duration of your request.</p>
<h2><a class="anchor" aria-hidden="true" id="delegate-dataloader"></a><a href="#delegate-dataloader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delegate DataLoader</h2>
<p>With the class <em>DataLoader</em> you have full controll of how the <em>DataLoader</em> works. But in many cases this control is not needed. We have specified four classes of <em>DataLoaders</em> that can be specified as delegate.</p>
<h3><a class="anchor" aria-hidden="true" id="batch-dataloader"></a><a href="#batch-dataloader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Batch DataLoader</h3>
<p>The batch <em>DataLoader</em> collects requests for entities per processing level and send them as a batch request to the data source. Moreover, the <em>DataLoader</em> caches the retrieved entries within a request.</p>
<p>The batch <em>DataLoader</em> gets the keys as <code>IReadOnlyList&lt;TKey&gt;</code> and returns a <code>IReadOnlyDictionary&lt;TKey, TValue&gt;</code>.</p>
<pre><code class="hljs css language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;Person&gt; <span class="hljs-title">GetPerson</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> id, IResolverContext context, [Service]IPersonRepository repository</span>)</span>
{
    <span class="hljs-keyword">return</span> context.BatchDataLoader&lt;<span class="hljs-keyword">string</span>, Person&gt;(<span class="hljs-string">"personByIdBatch"</span>, keys =&gt; repository.GetPersonBatchAsync(keys)).LoadAsync(id);
}
</code></pre>
<p><em>An example with the <strong>Batch Dataloader</strong> can be found <a href="https://github.com/ChilliCream/hotchocolate-examples/blob/master/DataLoader/MessageType.cs">here</a>.</em></p>
<h3><a class="anchor" aria-hidden="true" id="group-dataloader"></a><a href="#group-dataloader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Group DataLoader</h3>
<p>The Group <em>DataLoader</em> is also a batch <em>DataLoader</em> but instead of returning one entity per key it returns multiple entities per key. As with the Batch <em>DataLoader</em> retrieved collections are cached within a request.</p>
<p>The batch <em>DataLoader</em> gets the keys as <code>IReadOnlyList&lt;TKey&gt;</code> and returns a <code>ILookup&lt;TKey, TValue&gt;</code>.</p>
<pre><code class="hljs css language-csharp"><span class="hljs-keyword">public</span> Task&lt;IEnumerable&lt;Person&gt;&gt; GetPersonByCountry(<span class="hljs-keyword">string</span> country, IResolverContext context, [Service]IPersonRepository repository)
{
    <span class="hljs-keyword">return</span> context.GroupDataLoader&lt;<span class="hljs-keyword">string</span>, Person&gt;(<span class="hljs-string">"personByCountry"</span>, keys =&gt; repository.GetPersonsByCountry(keys).ToLookup(t =&gt; t.Country)).LoadAsync(country);
}
</code></pre>
<p><em>An example with the <strong>Batch Dataloader</strong> can be found <a href="https://github.com/ChilliCream/hotchocolate-examples/blob/master/DataLoader/QueryType.cs">here</a>.</em></p>
<h3><a class="anchor" aria-hidden="true" id="cache-dataloader"></a><a href="#cache-dataloader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cache DataLoader</h3>
<p>The cache <em>DataLoader</em> is basically the easiest to implement since there is no batching involved. So, we can just use the initial <code>GetPersonById</code> method. We, do not get the benefits of batching with this one, but if in a query graph the same entity is resolved twice we will load it only once from the data source.</p>
<pre><code class="hljs css language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;Person&gt; <span class="hljs-title">GetPerson</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> id, IResolverContext context, [Service]IPersonRepository repository</span>)</span>
{
    <span class="hljs-keyword">return</span> context.CacheDataLoader&lt;<span class="hljs-keyword">string</span>, Person&gt;(<span class="hljs-string">"personById"</span>, keys =&gt; repository.GetPersonById(keys)).LoadAsync(id);
}
</code></pre>
<p><em>An example with the <strong>Batch Dataloader</strong> can be found <a href="https://github.com/ChilliCream/hotchocolate-examples/blob/master/DataLoader/MessageType.cs">here</a>.</em></p>
<h3><a class="anchor" aria-hidden="true" id="fetch-once"></a><a href="#fetch-once" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fetch Once</h3>
<p><code>FetchOnceAsync</code> is not really a <em>DataLoader</em> like described by facebook. It rather uses the infrastructure of our <em>DataLoader</em> to provide an easy way to provide cache heavy resource calls that shall only be done once per request.</p>
<pre><code class="hljs css language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Task&lt;Person&gt; <span class="hljs-title">GetPerson</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> id, IResolverContext context, [Service]IPersonRepository repository</span>)</span>
{
    <span class="hljs-keyword">return</span> context.FetchOnceAsync(<span class="hljs-string">"cachingLoader"</span>, () =&gt; repository.GetSomeResource());
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="stacked-dataloader-calls"></a><a href="#stacked-dataloader-calls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stacked DataLoader Calls</h2>
<p>This is more like an edge case that is supported than a certain type of <em>DataLoader</em>. Somtime we have more complex resolvers that might first fetch data from one <em>DataLoader</em> and use that to fetch data from the next. With the new <em>DataLoader</em> implementation this is supported and under test.</p>
<pre><code class="hljs css language-csharp"><span class="hljs-keyword">public</span> Task&lt;IEnumerable&lt;Customer&gt;&gt; GetCustomers(<span class="hljs-keyword">string</span> personId, IResolverContext context, [Service]IPersonRepository personRepository, [Service]ICustomerRepository customerRepository)
{
    Person person = <span class="hljs-keyword">await</span> context.DataLoader(<span class="hljs-string">"personLoader"</span>, keys =&gt; repository.GetPersonById(keys)).LoadAsync(id);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> context.DataLoader(<span class="hljs-string">"customerLoader"</span>, keys =&gt; repository.GetCustomerById(keys)).LoadAsync(person.CustomerIds);
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="global-dataloader"></a><a href="#global-dataloader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Global DataLoader</h2>
<p>Global <em>DataLoader</em> are <em>DataLoader</em> that are shared between requests. This can be useful for certain caching strategies.</p>
<p>In order to add support for global <em>DataLoader</em> you can add a second <em>DataLoader</em> registry. This one has to be declared as singleton. It is important that you declare the global registry first since we use the last registry to register  ad-hoc <em>DataLoader</em>.</p>
<pre><code class="hljs css language-csharp">services.AddSingleto&lt;IDataLoaderRegistry, DataLoaderRegistry&gt;();
services.AddDataLoaderRegistry();
</code></pre>
<p>It is important to know that you always have to do <code>AddDataLoaderRegistry</code> since this also sets up the batch operation that is needed to hook up the execution engine with the <em>DataLoader</em> registry.</p>
<h2><a class="anchor" aria-hidden="true" id="greendonut"></a><a href="#greendonut" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GreenDonut</h2>
<p>For more information about our <em>DataLoader</em> implementation head over to our <em>DataLoader</em> <a href="https://github.com/ChilliCream/greendonut">GitHub repository</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="custom-data-loaders-and-batch-operations"></a><a href="#custom-data-loaders-and-batch-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Data Loaders and Batch Operations</h2>
<p>With the new API we are introducing the <code>IBatchOperation</code> interface. The query engine will fetch all batch operations and trigger those once all data resolvers in one batch are running. We have implemented this interface for our <em>DataLoader</em> aswell. So, if you want to implement some database batching or integrate a custom <em>DataLoader</em> than this interface is your friend. There is also a look ahead available which will provide you with the fields that have to be fetched.</p>
<p>If you are planung to implement something in this area get in contact with us and we provide you with more information.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-2-2 by Michael Staib</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/next/custom-scalar-types"><span class="arrow-prev">← </span><span>Scalar Type Support</span></a><a class="docs-next button" href="/docs/next/pagination"><span>Pagination</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#data-loaders">Data Loaders</a></li><li><a href="#class-dataloader">Class DataLoader</a></li><li><a href="#delegate-dataloader">Delegate DataLoader</a><ul class="toc-headings"><li><a href="#batch-dataloader">Batch DataLoader</a></li><li><a href="#group-dataloader">Group DataLoader</a></li><li><a href="#cache-dataloader">Cache DataLoader</a></li><li><a href="#fetch-once">Fetch Once</a></li></ul></li><li><a href="#stacked-dataloader-calls">Stacked DataLoader Calls</a></li><li><a href="#global-dataloader">Global DataLoader</a></li><li><a href="#greendonut">GreenDonut</a></li><li><a href="#custom-data-loaders-and-batch-operations">Custom Data Loaders and Batch Operations</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/signet.svg" alt="Hot Chocolate" width="64" height="64"/></a><div><h5>Docs</h5><a href="/docs/introduction.html">Quickstart</a><a href="/docs/code-first-introduction.html">Code-First</a><a href="/docs/options.html">General</a></div><div><h5>Examples</h5><a href="/docs/example-star-wars-code-first.html">Star Wars</a></div><div><h5>Community</h5><a href="https://twitter.com/Chilli_Cream" target="_blank" rel="noreferrer noopener">Follow us on Twitter</a><a href="http://stackoverflow.com/questions/tagged/hotchocolate" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://chillicream.com/blog" target="_blank">Blog</a><a href="https://github.com/ChilliCream/hotchocolate" target="_blank">GitHub</a><a href="https://github.com/ChilliCream/hotchocolate/issues" target="_blank">Issues</a><a class="github-button" href="https://github.com/ChilliCream/hotchocolate" data-icon="octicon-star" data-count-href="/chillicream/hotchocolate/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2019 <a href="https://chillicream.com" target="_blank">ChilliCream</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '47d61652587888cd5144dcdd6fb9117b',
                indexName: 'hotchocolate',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:en","version:next"]}
              });
            </script></body></html>